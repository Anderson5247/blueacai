<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blue A√ßa√≠ ‚Äì Card√°pio Interativo</title>
    <style>
        :root {
            --purple: #5A0F8D;
            --light-purple: #F3E5FF;
            --dark-text: #333;
            --card-bg: #fff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--light-purple);
            color: var(--dark-text);
        }

        header {
            background: var(--purple);
            color: #fff;
            text-align: center;
            padding: 1rem;
        }

        header img {
            max-width: 120px;
            margin-bottom: .5rem;
        }

        main {
            max-width: 800px;
            margin: 1rem auto;
            padding: 0 1rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        fieldset {
            border: none;
            margin: 1rem 0;
            transition: opacity .3s;
        }

        fieldset[disabled] {
            opacity: .6;
            pointer-events: none; /* Impede intera√ß√£o */
        }

        legend {
            font-weight: bold;
            margin-bottom: .5rem;
            color: var(--purple); /* Destaca a legenda */
        }
        legend .section-status {
            font-weight: normal;
            font-size: 0.85em;
            color: #666;
            margin-left: 5px;
        }


        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: .75rem;
        }

        label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: .95rem;
            padding: 5px; /* Pequeno padding para facilitar clique */
            border-radius: 4px;
            transition: background-color 0.2s;
        }
         label:hover {
             background-color: #f0f0f0; /* Feedback visual no hover */
         }

        label input[type="checkbox"],
        label input[type="radio"] {
            margin-right: .5rem;
             cursor: pointer;
        }

        .counter {
            margin-left: .5rem;
            color: var(--purple);
            font-weight: normal;
            font-size: .9rem;
        }

        .buttons {
            display: flex;
            gap: .5rem;
            flex-wrap: wrap;
            margin-top: 1.5rem; /* Mais espa√ßo antes dos bot√µes */
        }

        .buttons button {
            flex: 1;
            min-width: 120px;
            padding: .75rem;
            border: none;
            border-radius: 4px;
            background: var(--purple);
            color: #fff;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .buttons button:hover:not(:disabled) {
            background-color: #4a0c74; /* Escurece no hover */
        }


        .buttons button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        #summary {
            /* Mantido no DOM para o JS, mas n√£o vis√≠vel */
            display: none;
            white-space: pre-wrap;
            background: #f9f9f9;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            font-size: .9rem;
            line-height: 1.5;
            border: 1px solid #eee;
        }

        #ordersSection {
             border-top: 2px solid var(--purple); /* Divisor visual */
             margin-top: 1.5rem;
             padding-top: 1rem;
        }

        #ordersList li {
            margin-bottom: .75rem; /* Mais espa√ßo entre itens da lista */
            list-style: none; /* Remove bullet points padr√£o */
            padding-left: 1.5rem;
            position: relative;
            border-bottom: 1px dashed #eee; /* Separador leve */
            padding-bottom: 0.5rem;
        }
         #ordersList li::before {
            content: 'üç¶'; /* √çcone de a√ßa√≠ */
            position: absolute;
            left: 0;
            top: 0;
            font-size: 0.9em;
         }


        a#wppLink {
            display: inline-flex; /* Alinha √≠cone e texto */
            align-items: center;
            gap: 0.5rem;
            background: #25D366;
            color: #fff;
            padding: .75rem 1rem;
            border-radius: 4px;
            text-decoration: none;
            font-size: .95rem;
            margin-top: 1rem;
            transition: background-color 0.2s;
            /* Inicialmente oculto */
             display: none;
        }
         a#wppLink:hover {
             background-color: #1ebe58;
         }
         a#wppLink::before {
             content: '‚ñ∂Ô∏è'; /* √çcone de envio */
             font-size: 1em;
         }

        .tamanhos-opcoes {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Ajuste de espa√ßamento */
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .tamanho-card {
            background: #fff;
            border: 2px solid #ccc;
            border-radius: 10px;
            padding: 1rem;
            width: 210px; /* Um pouco maior */
            text-align: center;
            transition: 0.3s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
             position: relative; /* Para o input radio */
        }
         .tamanho-card input[type="radio"] {
             position: absolute;
             top: 10px;
             right: 10px;
             transform: scale(1.3); /* R√°dio maior */
             cursor: pointer;
         }

        .tamanho-card:hover {
            border-color: var(--purple);
            transform: translateY(-3px); /* Leve eleva√ß√£o */
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.12);
        }
         /* Estilo quando selecionado */
        .tamanho-card input[type="radio"]:checked + div {
            /* Opcional: pode-se adicionar um estilo visual extra no div quando selecionado */
        }
         label.tamanho-card.selected {
              border-color: var(--purple);
              box-shadow: 0 5px 10px rgba(90, 15, 141, 0.2);
              background-color: #faf5ff;
          }


        .tamanho-card img {
            width: 100%;
            max-height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .tamanho-card strong {
            font-size: 1rem;
            color: #333;
            display: block;
            margin-top: 0.5rem;
        }

        .tamanho-card span {
            font-size: 0.85rem;
            color: #555;
            margin-top: 0.25rem;
            display: block;
            line-height: 1.3;
        }

        /* Estilo para op√ß√£o "Nenhuma" */
        label input[type="checkbox"][value="Nenhuma"] {
            /* Pode adicionar um estilo espec√≠fico se desejar */
        }
    </style>
</head>

<body>
    <header>
        <img src="logo.png" alt="Logomarca Blue A√ßa√≠" /> <h1>Blue A√ßa√≠</h1>
        <p>Monte seu a√ßa√≠ como quiser!</p>
    </header>

    <main>
        <div class="card">
            <form id="formPedido">
                <fieldset>
                    <legend>1. Escolha o Tamanho <span class="section-status">(Obrigat√≥rio)</span></legend>
                    <div class="tamanhos-opcoes">
                        <label class="tamanho-card" for="size-300">
                            <img src="copo-pequeno.jpg" alt="Copo Pequeno" />
                            <input type="radio" name="size" value="Copo Pequeno (300ml)" id="size-300" required />
                            <div>
                                <strong>Copo Pequeno (300ml)</strong>
                                <span>At√© 1 fruta, at√© 1 creme,<br>at√© 3 acompanhamentos,<br>at√© 1 cobertura</span>
                            </div>
                        </label>
                        <label class="tamanho-card" for="size-500">
                            <img src="copo-grande.jpg" alt="Copo Grande" />
                            <input type="radio" name="size" value="Copo Grande (500ml)" id="size-500" />
                            <div>
                                <strong>Copo Grande (500ml)</strong>
                                <span>At√© 2 frutas, at√© 2 cremes,<br>at√© 3 acompanhamentos,<br>at√© 1 cobertura</span>
                            </div>
                        </label>
                        <label class="tamanho-card" for="size-1L">
                            <img src="pote-felicidade.jpg" alt="Pote da Felicidade" />
                            <input type="radio" name="size" value="Pote da Felicidade (1L)" id="size-1L" />
                            <div>
                                <strong>Pote da Felicidade (1 litro)</strong>
                                <span>At√© 3 frutas, at√© 3 cremes,<br>at√© 4 acompanhamentos,<br>at√© 2 coberturas</span>
                            </div>
                        </label>
                    </div>
                </fieldset>

                <fieldset id="fsFrutas" disabled>
                    <legend>
                        2. Frutas <span id="cntFrutas" class="counter">(0/?)</span>
                    </legend>
                    <div class="grid-2" id="boxFrutas">
                        <label><input type="checkbox" value="Morango" />Morango</label>
                        <label><input type="checkbox" value="Banana" />Banana</label>
                        <label><input type="checkbox" value="Kiwi" />Kiwi</label>
                        <label><input type="checkbox" value="Ma√ß√£" />Ma√ß√£</label>
                        <label><input type="checkbox" value="Uva" />Uva</label>
                        <label><input type="checkbox" value="Nenhuma" />Nenhuma das op√ß√µes</label>
                    </div>
                </fieldset>

                <fieldset id="fsCremes" disabled>
                    <legend>
                        3. Cremes <span id="cntCremes" class="counter">(0/?)</span>
                    </legend>
                    <div class="grid-2" id="boxCremes">
                        <label><input type="checkbox" value="Ninho" />Ninho</label>
                        <label><input type="checkbox" value="Maracuj√°" />Maracuj√°</label>
                        <label><input type="checkbox" value="Morango" />Morango</label>
                        <label><input type="checkbox" value="Tutti Frutti" />Tutti Frutti</label>
                        <label><input type="checkbox" value="Chocolate com Avel√£" />Chocolate c/Avel√£</label>
                        <label><input type="checkbox" value="Nenhuma" />Nenhuma das op√ß√µes</label>
                    </div>
                </fieldset>

                <fieldset id="fsAccomp" disabled>
                    <legend>4. Acompanhamentos <span id="cntAccomp" class="counter">(0/?)</span></legend>
                    <div class="grid-2" id="boxAccomp">
                        <label><input type="checkbox" value="Amendoim" />Amendoim</label>
                        <label><input type="checkbox" value="Pa√ßoca" />Pa√ßoca</label>
                        <label><input type="checkbox" value="Granola" />Granola</label>
                        <label><input type="checkbox" value="Farinha L√°ctea" />Farinha L√°ctea</label>
                        <label><input type="checkbox" value="Leite em P√≥" />Leite em P√≥</label>
                        <label><input type="checkbox" value="Confetes" />Confetes</label>
                        <label><input type="checkbox" value="Tapioca" />Tapioca</label>
                        <label><input type="checkbox" value="Uva Passa" />Uva Passa</label>
                        <label><input type="checkbox" value="Nenhuma" />Nenhuma das op√ß√µes</label>
                    </div>
                </fieldset>

                <fieldset id="fsCoverage" disabled>
                    <legend>5. Cobertura(s) <span id="cntCover" class="counter">(0/?)</span></legend>
                    <div class="grid-2" id="boxCoverage">
                        <label><input type="checkbox" value="Chocolate" />Chocolate</label>
                        <label><input type="checkbox" value="Morango" />Morango</label>
                        <label><input type="checkbox" value="Leite Condensado" />Leite Condensado</label>
                        <label><input type="checkbox" value="Tutti Frutti" />Tutti Frutti</label>
                        <label><input type="checkbox" value="Ice Blue" />Ice Blue</label>
                        <label><input type="checkbox" value="Kiwi" />Kiwi</label>
                        <label><input type="checkbox" value="Nenhuma" />Nenhuma das op√ß√µes</label>
                    </div>
                </fieldset>

                <fieldset id="fsAskAdd" disabled>
                     <legend>6. Deseja adicionais? <span class="section-status">(Obrigat√≥rio)</span></legend>
                    <div class="grid-2">
                        <label><input type="radio" name="wantAdd" value="Sim" required />Sim</label>
                        <label><input type="radio" name="wantAdd" value="N√£o" />N√£o</label>
                    </div>
                </fieldset>

                <fieldset id="fsAdd" disabled>
                    <legend>7. Adicionais <span id="cntAdd" class="counter">(0/14)</span></legend>
                    <div class="grid-2" id="boxAdd">
                         <label><input type="checkbox" value="Ovomaltine R$ 1.00" />Ovomaltine R$ 1.00</label>
                        <label><input type="checkbox" value="Escureto R$ 1.00" />Escureto R$ 1.00</label>
                        <label><input type="checkbox" value="Chocoball R$ 1.00" />Chocoball R$ 1.00</label>
                        <label><input type="checkbox" value="Amendoim R$ 1.00" />Amendoim R$ 1.00</label>
                        <label><input type="checkbox" value="Pa√ßoca R$ 1.00" />Pa√ßoca R$ 1.00</label>
                        <label><input type="checkbox" value="Granola R$ 1.00" />Granola R$ 1.00</label>
                        <label><input type="checkbox" value="Farinha L√°ctea R$ 1.00" />Farinha L√°ctea R$ 1.00</label>
                        <label><input type="checkbox" value="Leite em p√≥ R$ 1.00" />Leite em p√≥ R$ 1.00</label>
                        <label><input type="checkbox" value="Confetes R$ 1.00" />Confetes R$ 1.00</label>
                        <label><input type="checkbox" value="Tapioca R$ 1.00" />Tapioca R$ 1.00</label>
                        <label><input type="checkbox" value="Uva Passa R$ 1.00" />Uva Passa R$ 1.00</label>
                        <label><input type="checkbox" value="M&MS R$ 1.00" />M&MS R$ 1.00</label>
                        <label><input type="checkbox" value="Marshmallow R$ 1.00" />Marshmallow R$ 1.00</label>
                        <label><input type="checkbox" value="Doce de leite R$ 1.00" />Doce de leite R$ 1.00</label>
                         <label><input type="checkbox" value="Nenhuma" />Nenhum Adicional</label> </div>
                </fieldset>

                <fieldset id="fsPayment" disabled>
                    <legend>8. Forma de Pagamento <span class="section-status">(Obrigat√≥rio)</span></legend>
                    <div class="grid-2">
                        <label><input type="radio" name="payment" value="Pix" required />Pix</label>
                        <label><input type="radio" name="payment" value="Dinheiro" />Dinheiro</label>
                        <label><input type="radio" name="payment" value="Cart√£o" />Cart√£o</label>
                    </div>
                </fieldset>

                <fieldset id="fsDelivery" disabled>
                     <legend>9. Entrega ou Retirada <span class="section-status">(Obrigat√≥rio)</span></legend>
                    <div class="grid-2">
                        <label><input type="radio" name="delivery" value="Retirada" required />Retirada</label>
                        <label><input type="radio" name="delivery" value="Entrega" />Entrega</label>
                    </div>
                </fieldset>

                <div class="buttons">
                    <button type="button" id="btnAdd" disabled>‚ûï Adicionar Outro Pedido</button>
                    <button type="button" id="btnFinish" disabled>‚úÖ Finalizar e Enviar</button>
                </div>
            </form>
        </div>

        <div class="card" id="ordersSection" style="display:none">
            <h2>Seus Pedidos:</h2>
            <ul id="ordersList"></ul>
        </div>

        <div id="summary" style="display: none;"></div>
        <a id="wppLink" href="#" target="_blank"> Enviar Pedido via WhatsApp</a> </main>

    <script>
        // Refer√™ncias aos elementos do formul√°rio
        const fs = {
            frutas: document.getElementById('fsFrutas'),
            cremes: document.getElementById('fsCremes'),
            accomp: document.getElementById('fsAccomp'),
            cover: document.getElementById('fsCoverage'),
            askAdd: document.getElementById('fsAskAdd'),
            add: document.getElementById('fsAdd'),
            payment: document.getElementById('fsPayment'),
            delivery: document.getElementById('fsDelivery')
        };
        // Refer√™ncias aos contadores
        const cnt = {
            frutas: document.getElementById('cntFrutas'),
            cremes: document.getElementById('cntCremes'),
            accomp: document.getElementById('cntAccomp'),
            cover: document.getElementById('cntCover'),
            add: document.getElementById('cntAdd')
        };
        // Bot√µes
        const btnAdd = document.getElementById('btnAdd');
        const btnFinish = document.getElementById('btnFinish');
        // Se√ß√£o de Pedidos
        const ordersSec = document.getElementById('ordersSection');
        const ordersList = document.getElementById('ordersList');
        // Resumo e Link WPP
        const summaryEl = document.getElementById("summary");
        const wppLink = document.getElementById("wppLink");
        // Formul√°rio
        const form = document.getElementById('formPedido');

        // Estado do pedido atual e lista de pedidos
        let state = {};
        let orders = [];

        // Fun√ß√µes utilit√°rias para habilitar/desabilitar fieldsets
        const enable = el => el.removeAttribute('disabled');
        const disable = el => el.setAttribute('disabled', '');

        // Fun√ß√£o para configurar checkboxes com limite (N√ÉO OBRIGAT√ìRIO) e l√≥gica "Nenhuma"
        function setupChecks(containerId, max, key) {
            const box = document.getElementById(containerId);
            const counterEl = cnt[key];
            const checkboxes = box.querySelectorAll('input[type=checkbox]');
            const noneCheckbox = box.querySelector('input[value="Nenhuma"]'); // Acha o checkbox "Nenhuma"

            // Inicializa o estado para esta chave como array vazio se n√£o existir
             if (!state[key]) { state[key] = []; }

            // Atualiza o contador inicial e a legenda
            updateCounter(counterEl, state[key].length, max);

            checkboxes.forEach(chk => {
                chk.onchange = () => {
                    const currentSelected = [...box.querySelectorAll('input:checked')];
                    let isNoneChecked = noneCheckbox && noneCheckbox.checked;

                    // L√≥gica do "Nenhuma"
                    if (noneCheckbox) {
                        // Se "Nenhuma" foi clicado e marcado
                        if (chk === noneCheckbox && chk.checked) {
                            checkboxes.forEach(otherChk => {
                                if (otherChk !== noneCheckbox) otherChk.checked = false;
                            });
                             state[key] = ['Nenhuma']; // Define o estado como apenas 'Nenhuma'
                             isNoneChecked = true;
                        }
                        // Se outra op√ß√£o foi clicada e marcada, desmarca "Nenhuma"
                        else if (chk !== noneCheckbox && chk.checked && isNoneChecked) {
                             noneCheckbox.checked = false;
                             isNoneChecked = false;
                             // Recalcula selecionados pois 'Nenhuma' foi desmarcado
                              state[key] = [...box.querySelectorAll('input:checked')].map(i => i.value);
                        }
                         // Se a √∫ltima op√ß√£o (exceto "Nenhuma") for desmarcada, n√£o faz nada especial com "Nenhuma"
                         else {
                              // Atualiza o estado normal baseado nos checkboxes marcados
                               state[key] = currentSelected.filter(c => c !== noneCheckbox || !isNoneChecked).map(i => i.value); // Filtra 'Nenhuma' se estiver desmarcado
                         }

                    } else {
                         // Se n√£o h√° checkbox "Nenhuma", apenas atualiza o estado
                         state[key] = currentSelected.map(i => i.value);
                    }


                    // Aplica o limite M√ÅXIMO (sem contar 'Nenhuma' se marcado)
                    const actualSelectedCount = state[key].includes('Nenhuma') ? 0 : state[key].length;
                    if (actualSelectedCount > max) {
                        chk.checked = false; // Desmarca a √∫ltima sele√ß√£o excedente
                        // Atualiza a lista de selecionados novamente
                        const finalSelected = [...box.querySelectorAll('input:checked')].filter(c => c !== noneCheckbox || !isNoneChecked);
                        state[key] = finalSelected.map(i => i.value);
                        updateCounter(counterEl, state[key].length, max); // Atualiza contador
                        alert(`Voc√™ pode escolher no m√°ximo ${max} ${key === 'add' ? 'adicionais' : key}.`); // Informa o usu√°rio
                        return;
                    }

                    // Atualiza o contador com a contagem correta
                    updateCounter(counterEl, state[key].length, max);

                    // N√ÉO AVAN√áA AUTOMATICAMENTE AQUI
                };
            });
        }

        // Fun√ß√£o para atualizar o texto do contador
        function updateCounter(element, count, max) {
            if (element) {
                 // Se 'Nenhuma' est√° selecionado, mostra 0, sen√£o mostra a contagem real
                 const displayCount = state[element.id.replace('cnt','').toLowerCase()]?.includes('Nenhuma') ? 0 : count;
                 element.textContent = `( ${displayCount} / ${max} )`;
                 element.style.display = 'inline'; // Garante que o contador est√° vis√≠vel
            }
        }


        // Fun√ß√£o para avan√ßar entre as etapas controladas por R√ÅDIOS
        function advance(stage) {
            switch (stage) {
                case 'askAdd':
                    if (state.wantAdd === 'Sim') {
                        enable(fs.add);
                        enable(fs.payment); // Habilita pagamento ap√≥s responder sobre add
                    } else if (state.wantAdd === 'N√£o') {
                         state.add = [];
                         disable(fs.add);
                         clearCheckboxes(fs.add);
                         enable(fs.payment); // Habilita pagamento ap√≥s responder sobre add
                    }
                    break;
                case 'payment':
                    if(state.payment) enable(fs.delivery);
                    break;
                case 'delivery':
                    if (state.delivery) {
                         checkIfCanFinish();
                    }
                    break;
            }
        }

        // Verifica se pode habilitar os bot√µes finais
        function checkIfCanFinish() {
            if (state.size && state.wantAdd && state.payment && state.delivery) {
                btnAdd.disabled = false;
                btnFinish.disabled = false;
            } else {
                btnAdd.disabled = true;
                btnFinish.disabled = true;
            }
        }


        // Event listener para a sele√ß√£o de TAMANHO
        document.querySelectorAll('input[name="size"]').forEach(radio => {
            radio.onchange = e => {
                document.querySelectorAll('.tamanho-card').forEach(label => label.classList.remove('selected'));
                e.target.closest('.tamanho-card').classList.add('selected');

                resetPartial();
                state.size = e.target.value;

                let frutasMax = 0, cremesMax = 0, accompMax = 0, coberturaMax = 0;
                const addMax = 14;

                if (state.size === 'Copo Pequeno (300ml)') {
                    frutasMax = 1; cremesMax = 1; accompMax = 3; coberturaMax = 1;
                } else if (state.size === 'Copo Grande (500ml)') {
                    frutasMax = 2; cremesMax = 2; accompMax = 3; coberturaMax = 1;
                } else if (state.size === 'Pote da Felicidade (1L)') {
                    frutasMax = 3; cremesMax = 3; accompMax = 4; coberturaMax = 2;
                }

                state.fMax = frutasMax; state.cMax = cremesMax; state.aMax = accompMax; state.coMax = coberturaMax; state.addMax = addMax;

                 enable(fs.frutas);
                 enable(fs.cremes);
                 enable(fs.accomp);
                 enable(fs.cover);
                 enable(fs.askAdd);

                 setupChecks('boxFrutas', frutasMax, 'frutas');
                 setupChecks('boxCremes', cremesMax, 'cremes');
                 setupChecks('boxAccomp', accompMax, 'accomp');
                 setupChecks('boxCoverage', coberturaMax, 'cover');
                 setupChecks('boxAdd', addMax, 'add');

                 updateCounter(cnt.frutas, 0, frutasMax);
                 updateCounter(cnt.cremes, 0, cremesMax);
                 updateCounter(cnt.accomp, 0, accompMax);
                 updateCounter(cnt.cover, 0, coberturaMax);
                 updateCounter(cnt.add, 0, addMax);

                 setupRadioListener('wantAdd', 'askAdd');
                 setupRadioListener('payment', 'payment');
                 setupRadioListener('delivery', 'delivery');

                 disable(fs.add);
                 disable(fs.payment);
                 disable(fs.delivery);
                 btnAdd.disabled = true;
                 btnFinish.disabled = true;
            };
        });

        // Fun√ß√£o auxiliar para configurar listeners de radio buttons
         function setupRadioListener(name, stageToAdvance) {
            document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                r.onchange = ev => {
                    state[name] = ev.target.value;
                    document.querySelectorAll(`input[name="${name}"]`).forEach(radioEl => {
                        radioEl.closest('label')?.classList.remove('selected-radio');
                    });
                     ev.target.closest('label')?.classList.add('selected-radio');
                    advance(stageToAdvance);
                };
            });
        }

        // A√ß√µes dos Bot√µes
        btnAdd.onclick = () => {
            if(isOrderReadyToAdd()) {
                orders.push({ ...state });
                renderOrders();
                resetForm();
                 document.querySelectorAll('.tamanho-card').forEach(label => label.classList.remove('selected'));
            } else {
                alert("Por favor, preencha todas as etapas obrigat√≥rias (Tamanho, Adicionais Sim/N√£o, Pagamento, Entrega) antes de adicionar o pedido.");
            }
        };

        btnFinish.onclick = () => {
             if(isOrderReadyToAdd()) {
                  let lastOrder = orders[orders.length - 1];
                  let isDifferent = !lastOrder || JSON.stringify(lastOrder) !== JSON.stringify(state);
                  if(isDifferent) {
                       orders.push({ ...state });
                  }
                 renderOrders();
                 showSummary(); // Gera o texto, mas n√£o mostra a div
                 renderWpp();
                 disableAll();
                 btnFinish.disabled = true;
                 btnAdd.disabled = true;
             } else {
                 alert("Por favor, preencha todas as etapas obrigat√≥rias (Tamanho, Adicionais Sim/N√£o, Pagamento, Entrega) antes de finalizar.");
             }
        };

        // Verifica se as etapas OBRIGAT√ìRIAS controladas por radio foram preenchidas
        function isOrderReadyToAdd() {
             state.frutas = state.frutas || [];
             state.cremes = state.cremes || [];
             state.accomp = state.accomp || [];
             state.cover = state.cover || [];
             state.add = state.add || [];

            return state.size &&
                   state.wantAdd &&
                   state.payment &&
                   state.delivery;
        }


        // Renderiza a lista de pedidos adicionados
        function renderOrders() {
            ordersSec.style.display = orders.length > 0 ? 'block' : 'none';
            ordersList.innerHTML = '';

            orders.forEach((o, i) => {
                const li = document.createElement('li');
                 const displayFrutas = o.frutas?.length > 0 && !o.frutas.includes('Nenhuma') ? o.frutas.join(', ') : 'Nenhuma';
                 const displayCremes = o.cremes?.length > 0 && !o.cremes.includes('Nenhuma') ? o.cremes.join(', ') : 'Nenhum';
                 const displayAccomp = o.accomp?.length > 0 && !o.accomp.includes('Nenhuma') ? o.accomp.join(', ') : 'Nenhum';
                 const displayCover = o.cover?.length > 0 && !o.cover.includes('Nenhuma') ? o.cover.join(', ') : 'Nenhuma';
                 const displayAdd = o.add?.length > 0 && !o.add.includes('Nenhuma') ? o.add.join(', ') : 'Nenhum';

                li.innerHTML = `
                  <strong>Pedido ${i + 1}</strong><br>
                  Tamanho: ${o.size}<br>
                  Frutas (${o.frutas?.includes('Nenhuma') ? 0 : o.frutas?.length || 0}/${o.fMax}): ${displayFrutas}<br>
                  Cremes (${o.cremes?.includes('Nenhuma') ? 0 : o.cremes?.length || 0}/${o.cMax}): ${displayCremes}<br>
                  Acompanhamentos (${o.accomp?.includes('Nenhuma') ? 0 : o.accomp?.length || 0}/${o.aMax}): ${displayAccomp}<br>
                  Cobertura(s) (${o.cover?.includes('Nenhuma') ? 0 : o.cover?.length || 0}/${o.coMax}): ${displayCover}<br>
                  Adicionais (${o.add?.includes('Nenhuma') ? 0 : o.add?.length || 0}/${o.addMax}): ${displayAdd}<br>
                  Pagamento: ${o.payment || 'N√£o definido'}<br>
                  Entrega: ${o.delivery || 'N√£o definido'}
                `;
                ordersList.appendChild(li);
            });
        }

        // Gera o texto de resumo formatado para WhatsApp
        function showSummary() {
            let txt = '*Resumo do Pedido Blue A√ßa√≠*\n\n';
            orders.forEach((o, i) => {
                 const displayFrutas = o.frutas?.length > 0 && !o.frutas.includes('Nenhuma') ? o.frutas.join(', ') : 'Nenhuma';
                 const displayCremes = o.cremes?.length > 0 && !o.cremes.includes('Nenhuma') ? o.cremes.join(', ') : 'Nenhum';
                 const displayAccomp = o.accomp?.length > 0 && !o.accomp.includes('Nenhuma') ? o.accomp.join(', ') : 'Nenhum';
                 const displayCover = o.cover?.length > 0 && !o.cover.includes('Nenhuma') ? o.cover.join(', ') : 'Nenhuma';
                 const displayAdd = o.add?.length > 0 && !o.add.includes('Nenhuma') ? o.add.join(', ') : 'Nenhum';

                txt += `*Pedido ${i + 1}*\n`;
                txt += `- Tamanho: ${o.size}\n`;
                txt += `- Frutas: ${displayFrutas}\n`;
                txt += `- Cremes: ${displayCremes}\n`;
                txt += `- Acompanhamentos: ${displayAccomp}\n`;
                txt += `- Cobertura(s): ${displayCover}\n`;
                txt += `- Adicionais: ${displayAdd}\n`;
                txt += `- Pagamento: ${o.payment}\n`;
                txt += `- Entrega/Retirada: ${o.delivery}\n\n`;
            });
            summaryEl.textContent = txt; // Define o texto no elemento oculto
            // summaryEl.style.display = 'block'; // ****** ESTA LINHA FOI COMENTADA ******
        }

        // Cria o link do WhatsApp com a mensagem do resumo
        function renderWpp() {
            const phoneNumber = "5598985016035"; // SEU N√öMERO DE WHATSAPP
            // Usa o texto j√° armazenado no elemento summaryEl
            const msg = encodeURIComponent(summaryEl.textContent);
            wppLink.href = `https://wa.me/${phoneNumber}?text=${msg}`;
            wppLink.style.display = 'inline-flex'; // Torna o bot√£o WPP vis√≠vel
        }

        // Reseta o formul√°rio para adicionar um novo pedido ou no in√≠cio
        function resetForm() {
            form.reset();
            state = {};
             resetPartial();
             document.querySelectorAll('input[name="size"]').forEach(radio => radio.checked = false);
             document.querySelectorAll('.tamanho-card').forEach(label => label.classList.remove('selected'));
              document.querySelectorAll('.selected-radio').forEach(label => label.classList.remove('selected-radio'));

             ordersSec.style.display = orders.length > 0 ? 'block' : 'none';
             // summaryEl.style.display = 'none'; // J√° est√° none por padr√£o, n√£o precisa aqui
             wppLink.style.display = 'none';

             enable(document.querySelector('fieldset'));
        }

        // Reseta parcialmente o formul√°rio
        function resetPartial() {
             Object.values(fs).forEach(disable);
             Object.values(cnt).forEach(c => { if(c) { c.textContent = '(0/?)'; c.style.display = 'none'; } });
             // cnt.add.textContent = '(0/14)'; // Linha redundante se j√° pega no loop
              state.frutas = []; state.cremes = []; state.accomp = []; state.cover = []; state.add = [];
              state.wantAdd = undefined; state.payment = undefined; state.delivery = undefined;
              btnAdd.disabled = true;
              btnFinish.disabled = true;
              clearCheckboxes(fs.frutas);
              clearCheckboxes(fs.cremes);
              clearCheckboxes(fs.accomp);
              clearCheckboxes(fs.cover);
              clearCheckboxes(fs.add);
              clearRadios('wantAdd');
              clearRadios('payment');
              clearRadios('delivery');
              document.querySelectorAll('.selected-radio').forEach(label => label.classList.remove('selected-radio'));
        }

        // Fun√ß√£o auxiliar para limpar checkboxes
         function clearCheckboxes(fieldset) {
            if (fieldset) {
                fieldset.querySelectorAll('input[type="checkbox"]').forEach(chk => chk.checked = false);
            }
        }
        // Fun√ß√£o auxiliar para limpar radios
        function clearRadios(name) {
             document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.checked = false);
        }

        // Desabilita todos os fieldsets do formul√°rio
        function disableAll() {
            const allFieldsets = form.querySelectorAll('fieldset');
            allFieldsets.forEach(disable);
        }

         // Inicializa√ß√£o
         resetForm();

    </script>
</body>

</html>